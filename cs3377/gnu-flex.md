# GNU Flex
#wiki #cs3377 

GNU Flex is a rewrite of a tool called Lex which generates lexical analyzers (also called a [[tokenizer]]). It generates code that reads characters from an input stream and returns tokens along with associated meta-information.

More concretely, Lex will read patterns (written as a [[regex]]) and generate C code which will be your tokenizer.

## Usage
Flex works on files that end in `.lex` or `.l`. (`.l` is recommended). A Flex file looks like this (three sections separated by `%%`):

```flex
...definitions...
%%
...rules...
%%
...subroutines...
```

Each rule is a pair:

```text
regex { action statements in C; return the thing that matched }
```

The order in which you write rules matters! Write rules from most specific to least specific.

### Variables
Within Flex code, you may reference the following variables:

| Name               | Function                                  |
| ------------------ | ----------------------------------------- |
| `int yylex(void)`  | Invoke lexer, returns token               |
| `char *yytext`    | Pointer to matched string (C-style)       |
| `yyleng`           | Length of matched string                  |
| `yylval`           | Value associated with token               |
| `int yywrap(void)` | Wrap-up (return 1 if done, 0 if not done) |
| `FILE *yyout`      | Output file                               |
| `FILE *yyin`      | Input file                                |
| `INITIAL`          | Initial (start) condition                 |
| `BEGIN`            | Condition switch start condition          |
| `ECHO`             | Write matched string                      |


## Code Generation
### Usage within C
It uses the `.l` file create a C file that contains a function called `yylex()`, which implements a scanner (via a FSM) that recognizes the regexes and executes the appropriate actions when there is a match.

`yylex()` is not called for youâ€”you must write a main routine that calls it to get the tokens.

### Building with Makefiles
[[make]] has an implicit rule for lex/flex. `n.c` is made from `n.l` by running `flex`/`lex`.

```makefile
$(LEX) $(LFLAGS)
```

## Notes on C Mode vs C++ Mode
Flex by default operates in C mode, meaning it generates C-style code. While it does have a C++ mode, it is experimental and will not be used in this class.

[//begin]: # "Autogenerated link references for markdown compatibility"
[tokenizer]: tokenizer.md "Tokenizer"
[regex]: regex.md "Regular Expression"
[make]: make.md "Make"
[//end]: # "Autogenerated link references"